<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexAI - AI Workout Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple keyframe animation for the loading spinner */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            animation: spin 1s linear infinite;
        }
        /* Added styles for the modal transition */
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-bold text-gray-900">FlexAI</h1>
            <p class="text-xl text-gray-600 mt-2">Get a personalized workout plan based on the Real World Dataset</p>
        </header>

        <main>
            <!-- ====================================================== -->
            <!-- BMI CALCULATOR SECTION (NOW FIRST)                   -->
            <!-- ====================================================== -->
            <div class="bg-white p-8 rounded-xl shadow-lg mb-10">
                <h2 class="text-2xl font-bold mb-6 text-center">BMI Calculator</h2>
                <form id="bmi-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">Weight (kg)</label>
                        <input type="number" id="weight" name="weight" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., 70" required>
                    </div>
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700 mb-2">Height (cm)</label>
                        <input type="number" id="height" name="height" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., 175" required>
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors duration-300 shadow-md">Calculate BMI</button>
                    </div>
                </form>
                <div id="bmi-result" class="mt-6 text-center text-lg font-medium"></div>
            </div>

            <!-- Input Form Section -->
            <div class="bg-white p-8 rounded-xl shadow-lg mb-10">
                <h2 class="text-2xl font-bold mb-6 text-center">Create Your Workout</h2>
                <form id="workout-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="level" class="block text-sm font-medium text-gray-700 mb-2">Fitness Level</label>
                        <select id="level" name="level" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Beginner</option>
                            <option>Intermediate</option>
                            <option>Expert</option>
                        </select>
                    </div>
                    <div>
                        <label for="body_part" class="block text-sm font-medium text-gray-700 mb-2">Muscle Group</label>
                        <select id="body_part" name="body_part" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option>Back</option>
                            <option>Chest</option>
                            <option>Shoulders</option>
                            <option>Legs</option>
                            <option>Arms</option>
                            <option>Core</option>
                            <option>Full Body</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" id="generate-btn" class="w-full flex justify-center items-center gap-2 bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-md">
                            <span id="btn-text">Generate Plan</span>
                            <div id="btn-spinner" class="spinner hidden"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div id="results-container">
                <!-- Workout plan will be injected here -->
            </div>
        </main>
    </div>

    <!-- Modal for displaying full exercise details -->
    <div id="exercise-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden" onclick="closeModal()">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative" onclick="event.stopPropagation()">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <h2 id="modal-title" class="text-3xl font-bold mb-4 text-gray-900">Exercise Title</h2>
            <div class="flex flex-wrap gap-x-4 gap-y-2 mb-6 text-sm">
                <span id="modal-level" class="bg-indigo-100 text-indigo-800 font-medium px-3 py-1 rounded-full">Level</span>
                <span id="modal-bodypart" class="bg-green-100 text-green-800 font-medium px-3 py-1 rounded-full">Muscle Group</span>
                <span id="modal-equipment" class="bg-yellow-100 text-yellow-800 font-medium px-3 py-1 rounded-full">Equipment</span>
            </div>
            <div class="text-gray-700 leading-relaxed text-base">
                <p id="modal-desc">Full exercise description will go here.</p>
            </div>
        </div>
    </div>


    <script>
        // --- Workout Form Elements ---
        const form = document.getElementById('workout-form');
        const resultsContainer = document.getElementById('results-container');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const btnSpinner = document.getElementById('btn-spinner');

        // --- Modal Elements ---
        const modal = document.getElementById('exercise-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalLevel = document.getElementById('modal-level');
        const modalBodypart = document.getElementById('modal-bodypart');
        const modalEquipment = document.getElementById('modal-equipment');
        const modalDesc = document.getElementById('modal-desc');

        // --- BMI Calculator Elements ---
        const bmiForm = document.getElementById('bmi-form');
        const bmiResultEl = document.getElementById('bmi-result');

        // --- Event Listener for Workout Form ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Show loading state
            btnText.textContent = 'Generating...';
            btnSpinner.classList.remove('hidden');
            generateBtn.disabled = true;

            resultsContainer.innerHTML = `
                <div class="text-center p-8">
                    <div class="inline-block border-4 border-t-indigo-500 rounded-full w-12 h-12 animate-spin"></div>
                    <p class="mt-4 text-gray-600">Building your personalized plan...</p>
                </div>
            `;

            const formData = {
                level: document.getElementById('level').value,
                body_part: document.getElementById('body_part').value
            };

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const workoutPlan = await response.json();
                resultsContainer.innerHTML = ''; 

                if (workoutPlan.error) {
                    resultsContainer.innerHTML = `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center shadow-md">${workoutPlan.error}</div>`;
                } else {
                    let workoutHTML = '<h2 class="text-3xl font-bold text-center mb-6">Your Custom Workout Plan</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';
                    workoutPlan.forEach(exercise => {
                        workoutHTML += `
                            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer" 
                                 onclick='openModal(${JSON.stringify(exercise)})'>
                                <h3 class="font-bold text-xl mb-2 text-gray-900">${exercise.Title}</h3>
                                <div class="flex flex-wrap gap-2 mb-3 text-xs">
                                    <span class="bg-indigo-100 text-indigo-800 font-medium px-2.5 py-0.5 rounded-full">${exercise.Level}</span>
                                    <span class="bg-green-100 text-green-800 font-medium px-2.5 py-0.5 rounded-full">${exercise.BodyPart}</span>
                                </div>
                                <p class="text-gray-600 text-sm truncate">${exercise.Desc}</p>
                            </div>
                        `;
                    });
                    workoutHTML += '</div>';
                    resultsContainer.innerHTML = workoutHTML;
                }
            } catch (error) {
                resultsContainer.innerHTML = `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center shadow-md">An error occurred. Check the server logs.</div>`;
                console.error('Error:', error);
            } finally {
                btnText.textContent = 'Generate Plan';
                btnSpinner.classList.add('hidden');
                generateBtn.disabled = false;
            }
        });
        
        // --- Event Listener for BMI Form ---
        bmiForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if (weight > 0 && height > 0) {
                const heightInMeters = height / 100;
                const bmi = weight / (heightInMeters * heightInMeters);
                const bmiRounded = bmi.toFixed(1);

                let category = '';
                let colorClass = '';

                if (bmi < 18.5) {
                    category = 'Underweight';
                    colorClass = 'text-blue-600';
                } else if (bmi >= 18.5 && bmi <= 24.9) {
                    category = 'Normal weight';
                    colorClass = 'text-green-600';
                } else if (bmi >= 25 && bmi <= 29.9) {
                    category = 'Overweight';
                    colorClass = 'text-yellow-600';
                } else {
                    category = 'Obesity';
                    colorClass = 'text-red-600';
                }
                
                bmiResultEl.innerHTML = `Your BMI is <strong class="${colorClass}">${bmiRounded}</strong>. This is considered <strong class="${colorClass}">${category}</strong>.`;
            } else {
                bmiResultEl.innerHTML = `<span class="text-red-600">Please enter valid weight and height.</span>`;
            }
        });


        // --- Functions for Exercise Modal ---
        function openModal(exercise) {
            modalTitle.textContent = exercise.Title;
            modalLevel.textContent = exercise.Level;
            modalBodypart.textContent = exercise.BodyPart;
            modalEquipment.textContent = exercise.Equipment || 'N/A';
            modalDesc.textContent = exercise.Desc;
            modal.classList.remove('hidden');
            modal.classList.add('opacity-100');
        }

        function closeModal() {
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('opacity-100', 'opacity-0');
            }, 300);
        }

    </script>

</body>
</html>

